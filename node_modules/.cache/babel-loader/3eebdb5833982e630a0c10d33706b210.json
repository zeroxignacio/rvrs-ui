{"ast":null,"code":"import _regeneratorRuntime from\"/Users/ignacio/Documents/GitHub/reverse-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/ignacio/Documents/GitHub/reverse-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/ignacio/Documents/GitHub/reverse-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _taggedTemplateLiteral from\"/Users/ignacio/Documents/GitHub/reverse-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";var _templateObject,_templateObject2,_templateObject3,_templateObject4,_templateObject5,_templateObject6,_templateObject7,_templateObject8,_templateObject9,_templateObject10,_templateObject11;import BigNumber from'bignumber.js';import React,{useCallback,useState}from'react';import styled from'styled-components';import{useModal,Flex}from'@pancakeswap-libs/uikit';import{useWallet}from'@binance-chain/bsc-use-wallet';import{useERC20}from'hooks/useContract';import{useSousApprove}from'hooks/useApprove';import useI18n from'hooks/useI18n';import{useSousStake}from'hooks/useStake';import{useSousUnstake}from'hooks/useUnstake';import{getBalanceNumber}from'utils/formatBalance';import{useSousHarvest}from'hooks/useHarvest';import{QuoteToken,PoolCategory}from'config/constants/types';import useTokenBalance from'hooks/useTokenBalance';import{getCakeAddress}from'utils/addressHelpers';import DepositModal from'./DepositModal';import WithdrawModal from'./WithdrawModal';import Card from'./Card';import{usePriceCakeBusd}from\"../../../state/hooks\";import useWithdrawFeeTimer from\"./useWithdrawFeeTimer\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var QuoteTitle=styled.p(_templateObject||(_templateObject=_taggedTemplateLiteral([\"\\n  font-size: 20px;\\n  font-weight: 600;\\n  text-shadow: 1px 1px 5px #ccc;\\n  margin-top: 5px;\\n\"])));var QuoteTitle2=styled.p(_templateObject2||(_templateObject2=_taggedTemplateLiteral([\"\\n  color: #979797;\\n  font-size: 15px;\\n  font-weight: 300;\\n  text-shadow: 0px 0px 0px #ccc;\\n\"])));var Text1=styled.p(_templateObject3||(_templateObject3=_taggedTemplateLiteral([\"\\n  color: #EBEBEB;\\n  font-size: 15px;\\n  font-weight: 400;\\n  margin-bottom: 0px;\\n  text-shadow: 0px 0px 0px #ccc;\\n\"])));var Text11=styled.p(_templateObject4||(_templateObject4=_taggedTemplateLiteral([\"\\n  color: #EBEBEB;\\n  font-size: 15px;\\n  font-weight: 800;\\n  margin-bottom: 0px;\\n\"])));var Divider=styled.div(_templateObject5||(_templateObject5=_taggedTemplateLiteral([\"\\n  background-color: #7B7B7B;\\n  height: 1.5px;\\n  margin-left: auto;\\n  margin-right: auto;\\n  margin-top: 15px;\\n  margin-bottom: 15px;\\n  width: 100%;\\n\"])));var SmallText=styled.p(_templateObject6||(_templateObject6=_taggedTemplateLiteral([\"\\n  color: #979797;\\n  font-size: 15px;\\n  font-weight: 200;\\n  margin-bottom: 0px;\\n  margin-left: 20px;\\n\"])));var Wrapper=styled(Flex)(_templateObject7||(_templateObject7=_taggedTemplateLiteral([\"\\n  svg {\\n    margin-right: 0.25rem;\\n  }\\n\"])));var StyledBtn=styled.button(_templateObject8||(_templateObject8=_taggedTemplateLiteral([\"\\n  -webkit-box-align: center;\\n  align-items: center;\\n  background-color: rgba(0, 0, 0,0) !important;\\n  border: 1px;\\n  border-style: solid !important;\\n  border-color: #ffff !important;\\n  border-radius: 10px;\\n  color: #ffff;\\n  font-size: 15px;\\n  font-weight: 400;\\n  width: 100%;\\n  display: inline-flex;\\n  min-height: 30px;\\n  max-height: 30px;\\n  max-width: 135px;\\n  padding: 20px;\\n\"])));var StyledCardActions=styled.div(_templateObject9||(_templateObject9=_taggedTemplateLiteral([\"\\n  display: flex;\\n  justify-content: center;\\n  margin-top: 15px;\\n  width: 100%;\\n  margin-bottom: 15px;\\n  box-sizing: border-box;\\n\"])));var StyledActionSpacer=styled.div(_templateObject10||(_templateObject10=_taggedTemplateLiteral([\"\\n  height: \",\"px;\\n  width: \",\"px;\\n\"])),function(props){return props.theme.spacing[4];},function(props){return props.theme.spacing[4];});var StyledBtn2=styled.button(_templateObject11||(_templateObject11=_taggedTemplateLiteral([\"\\n  -webkit-box-align: center;\\n  align-items: center;\\n  background-color: rgba(0, 0, 0,0) !important;\\n  border: 1px;\\n  border-style: solid !important;\\n  border-color: #ffff !important;\\n  border-radius: 10px;\\n  color: #ffff;\\n  font-size: 15px;\\n  font-weight: 800;\\n  width: 100%;\\n  display: inline-flex;\\n  min-height: 30px;\\n  max-height: 30px;\\n  max-width: 118px;\\n  padding: 20px;\\n\\n  border: 2px solid #fff;\\n  box-shadow: 0px 0px 7px #ffff;\\n\"])));var PoolCard=function PoolCard(_ref){var pool=_ref.pool;var sousId=pool.sousId,stakingTokenName=pool.stakingTokenName,stakingTokenAddress=pool.stakingTokenAddress,apr=pool.apr,apy=pool.apy,tokenDecimals=pool.tokenDecimals,poolCategory=pool.poolCategory,isFinished=pool.isFinished,userData=pool.userData,stakingLimit=pool.stakingLimit,pricePerShare=pool.pricePerShare;var cakeBalance=getBalanceNumber(useTokenBalance(getCakeAddress())).toLocaleString('en-us',{maximumFractionDigits:0});var isBnbPool=poolCategory===PoolCategory.BINANCE;var TranslateString=useI18n();var stakingTokenContract=useERC20(stakingTokenAddress);var _useWallet=useWallet(),account=_useWallet.account;var _useSousApprove=useSousApprove(stakingTokenContract,sousId),onApprove=_useSousApprove.onApprove;var _useSousStake=useSousStake(sousId,isBnbPool),onStake=_useSousStake.onStake;var _useSousUnstake=useSousUnstake(sousId),onUnstake=_useSousUnstake.onUnstake;var _useSousHarvest=useSousHarvest(sousId,isBnbPool),onReward=_useSousHarvest.onReward;var rvrsPrice=usePriceCakeBusd();var _useWithdrawFeeTimer=useWithdrawFeeTimer(userData?userData.lastDepositedTime.toNumber():0,parseInt('259200',10)),secondsRemaining=_useWithdrawFeeTimer.secondsRemaining,hasUnstakingFee=_useWithdrawFeeTimer.hasUnstakingFee;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),requestedApproval=_useState2[0],setRequestedApproval=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),pendingTx=_useState4[0],setPendingTx=_useState4[1];var allowance=new BigNumber((userData===null||userData===void 0?void 0:userData.allowance)||0);var stakingTokenBalance=new BigNumber((userData===null||userData===void 0?void 0:userData.stakingTokenBalance)||0);var stakedBalance=new BigNumber((userData===null||userData===void 0?void 0:userData.stakedBalance)||0);var earnings=new BigNumber((userData===null||userData===void 0?void 0:userData.pendingReward)||0);var stakedBalanceUsd=stakedBalance.times(rvrsPrice);var isOldSyrup=stakingTokenName===QuoteToken.SYRUP;var accountHasStakedBalance=(stakedBalance===null||stakedBalance===void 0?void 0:stakedBalance.toNumber())>0;var needsApproval=!accountHasStakedBalance&&!allowance.toNumber()&&!isBnbPool;var isCardActive=isFinished&&accountHasStakedBalance;var convertedLimit=new BigNumber(stakingLimit).multipliedBy(new BigNumber(10).pow(tokenDecimals));var _useModal=useModal(/*#__PURE__*/_jsx(DepositModal,{max:stakingLimit&&stakingTokenBalance.isGreaterThan(convertedLimit)?convertedLimit:stakingTokenBalance,onConfirm:onStake,tokenName:stakingLimit?\"\".concat(stakingTokenName,\" (\").concat(stakingLimit,\" max)\"):stakingTokenName})),_useModal2=_slicedToArray(_useModal,1),onPresentDeposit=_useModal2[0];var _useModal3=useModal(/*#__PURE__*/_jsx(WithdrawModal,{max:stakedBalance,onConfirm:onUnstake,tokenName:stakingTokenName,pricePerShare:pricePerShare})),_useModal4=_slicedToArray(_useModal3,1),onPresentWithdraw=_useModal4[0];var handleApprove=useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var txHash;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;setRequestedApproval(true);_context.next=4;return onApprove();case 4:txHash=_context.sent;// user rejected tx or didn't go thru\nif(!txHash){setRequestedApproval(false);}_context.next=11;break;case 8:_context.prev=8;_context.t0=_context[\"catch\"](0);console.error(_context.t0);case 11:case\"end\":return _context.stop();}}},_callee,null,[[0,8]]);})),[onApprove,setRequestedApproval]);var TVL=pool.tvl&&pool.tvl.toNumber().toLocaleString('en-us',{maximumFractionDigits:0});var APY=apy&&apy.toNumber().toLocaleString('en-us',{maximumFractionDigits:0});var StakedUSDBalance=getBalanceNumber(stakedBalanceUsd).toLocaleString('en-us',{maximumFractionDigits:0});var FiveDayROI=apr&&apr.div(53).toNumber().toLocaleString('en-us',{maximumFractionDigits:0});var ExpectedBalance=apr&&apr.div(365).times(7).times(0.01).times(getBalanceNumber(stakedBalanceUsd)).plus(getBalanceNumber(stakedBalanceUsd)).toNumber().toLocaleString('en-us',{maximumFractionDigits:0});var TotalAPY=apy&&apy.plus(445).toNumber().toLocaleString('en-us',{maximumFractionDigits:0});var bal=getBalanceNumber(stakedBalance).toLocaleString('en-us',{maximumFractionDigits:0});return/*#__PURE__*/_jsx(Card,{isActive:isCardActive,isFinished:isFinished&&sousId!==0,children:/*#__PURE__*/_jsxs(\"div\",{style:{padding:'34px'},children:[/*#__PURE__*/_jsxs(Wrapper,{justifyContent:\"center\",alignItems:\"center\",padding:\"20px\",children:[/*#__PURE__*/_jsxs(Flex,{flexDirection:\"column\",alignItems:\"center\",children:[/*#__PURE__*/_jsx(QuoteTitle2,{children:\"Total APY\"}),/*#__PURE__*/_jsxs(QuoteTitle,{children:[TotalAPY,\"%\"]})]}),/*#__PURE__*/_jsxs(Flex,{flexDirection:\"column\",alignItems:\"center\",marginLeft:\"60px\",children:[/*#__PURE__*/_jsx(QuoteTitle2,{children:\" TVL\"}),/*#__PURE__*/_jsxs(QuoteTitle,{children:[\"$\",TVL]})]})]}),/*#__PURE__*/_jsxs(Flex,{justifyContent:\"space-between\",marginTop:\"18px\",children:[/*#__PURE__*/_jsx(Text1,{children:\"UST APY\"}),/*#__PURE__*/_jsx(Text1,{children:\"445%\"})]}),/*#__PURE__*/_jsxs(Flex,{justifyContent:\"space-between\",marginTop:\"10px\",children:[/*#__PURE__*/_jsx(Text1,{children:\"RVRS APY\"}),/*#__PURE__*/_jsxs(Text1,{children:[APY,\"%\"]})]}),/*#__PURE__*/_jsxs(Flex,{justifyContent:\"space-between\",marginTop:\"10px\",children:[/*#__PURE__*/_jsx(Text1,{children:\" 7 Day ROI\"}),/*#__PURE__*/_jsxs(Text1,{children:[FiveDayROI,\"%\"]})]}),/*#__PURE__*/_jsx(Divider,{}),/*#__PURE__*/_jsxs(Flex,{justifyContent:\"space-between\",marginTop:\"14px\",children:[/*#__PURE__*/_jsx(Text1,{children:\"Unstaked Balance\"}),/*#__PURE__*/_jsx(Text1,{children:cakeBalance})]}),/*#__PURE__*/_jsxs(Flex,{justifyContent:\"space-between\",marginTop:\"10px\",children:[/*#__PURE__*/_jsx(Text1,{children:\"Staked Balance\"}),/*#__PURE__*/_jsx(Text1,{children:bal})]}),/*#__PURE__*/_jsxs(Flex,{justifyContent:\"space-between\",marginTop:\"12px\",children:[/*#__PURE__*/_jsx(SmallText,{children:\"Balance (in UST)\"}),/*#__PURE__*/_jsxs(SmallText,{children:[\"$\",StakedUSDBalance]})]}),/*#__PURE__*/_jsxs(Flex,{justifyContent:\"space-between\",marginTop:\"5px\",children:[/*#__PURE__*/_jsx(SmallText,{children:\"Expected Balance (7 Days)\"}),/*#__PURE__*/_jsxs(SmallText,{children:[\"$\",ExpectedBalance]})]}),/*#__PURE__*/_jsx(Wrapper,{alignItems:\"end\",children:/*#__PURE__*/_jsx(Flex,{alignItems:\"end\",children:/*#__PURE__*/_jsx(StyledCardActions,{style:{alignItems:\"end\"},children:account&&(needsApproval&&!isOldSyrup?/*#__PURE__*/_jsx(\"div\",{style:{flex:1},children:/*#__PURE__*/_jsx(StyledBtn,{style:{minWidth:'100px',maxWidth:'150px',boxShadow:'0px 0px 5px #fff','marginTop':'10px'},disabled:isFinished||requestedApproval,onClick:handleApprove,children:\"Enable Staking\"})}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(StyledBtn,{style:{marginTop:'20px'},disabled:stakedBalance.eq(new BigNumber(0))||pendingTx,onClick:isOldSyrup?/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:setPendingTx(true);_context2.next=3;return onUnstake('0');case 3:setPendingTx(false);case 4:case\"end\":return _context2.stop();}}},_callee2);})):onPresentWithdraw,children:\"Unstake (0,0)\"}),/*#__PURE__*/_jsx(StyledActionSpacer,{}),!isOldSyrup&&/*#__PURE__*/_jsx(StyledBtn2,{style:{marginTop:'20px'},disabled:isFinished&&sousId!==0,onClick:onPresentDeposit,children:\"Stake (3,3)\"}),\" \"]}))})})})]})});};export default PoolCard;","map":{"version":3,"sources":["/Users/ignacio/Documents/GitHub/reverse-frontend/src/views/Pools/components/PoolCard.tsx"],"names":["BigNumber","React","useCallback","useState","styled","useModal","Flex","useWallet","useERC20","useSousApprove","useI18n","useSousStake","useSousUnstake","getBalanceNumber","useSousHarvest","QuoteToken","PoolCategory","useTokenBalance","getCakeAddress","DepositModal","WithdrawModal","Card","usePriceCakeBusd","useWithdrawFeeTimer","QuoteTitle","p","QuoteTitle2","Text1","Text11","Divider","div","SmallText","Wrapper","StyledBtn","button","StyledCardActions","StyledActionSpacer","props","theme","spacing","StyledBtn2","PoolCard","pool","sousId","stakingTokenName","stakingTokenAddress","apr","apy","tokenDecimals","poolCategory","isFinished","userData","stakingLimit","pricePerShare","cakeBalance","toLocaleString","maximumFractionDigits","isBnbPool","BINANCE","TranslateString","stakingTokenContract","account","onApprove","onStake","onUnstake","onReward","rvrsPrice","lastDepositedTime","toNumber","parseInt","secondsRemaining","hasUnstakingFee","requestedApproval","setRequestedApproval","pendingTx","setPendingTx","allowance","stakingTokenBalance","stakedBalance","earnings","pendingReward","stakedBalanceUsd","times","isOldSyrup","SYRUP","accountHasStakedBalance","needsApproval","isCardActive","convertedLimit","multipliedBy","pow","isGreaterThan","onPresentDeposit","onPresentWithdraw","handleApprove","txHash","console","error","TVL","tvl","APY","StakedUSDBalance","FiveDayROI","ExpectedBalance","plus","TotalAPY","bal","padding","alignItems","flex","minWidth","maxWidth","boxShadow","marginTop","eq"],"mappings":"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","sourcesContent":["import BigNumber from 'bignumber.js'\nimport React, { useCallback, useState } from 'react'\nimport styled from 'styled-components'\nimport { useModal, Flex } from '@pancakeswap-libs/uikit'\nimport { useWallet } from '@binance-chain/bsc-use-wallet'\nimport UnlockButton from 'components/UnlockButton'\nimport { useERC20 } from 'hooks/useContract'\nimport { useSousApprove } from 'hooks/useApprove'\nimport useI18n from 'hooks/useI18n'\nimport { useSousStake } from 'hooks/useStake'\nimport { useSousUnstake } from 'hooks/useUnstake'\nimport { getBalanceNumber } from 'utils/formatBalance'\nimport { useSousHarvest } from 'hooks/useHarvest'\nimport Balance from 'components/Balance'\nimport { QuoteToken, PoolCategory } from 'config/constants/types'\nimport { Pool } from 'state/types'\nimport useTokenBalance from 'hooks/useTokenBalance'\nimport { getCakeAddress } from 'utils/addressHelpers'\nimport { FaExternalLinkAlt, FaGithub, FaLongArrowAltRight } from 'react-icons/fa'\nimport DepositModal from './DepositModal'\nimport WithdrawModal from './WithdrawModal'\nimport Card from './Card'\nimport {usePriceCakeBusd} from \"../../../state/hooks\";\nimport useWithdrawFeeTimer from \"./useWithdrawFeeTimer\";\nimport WithdrawalFeeTimer from \"./withdrawFeeTimer\";\n\n\nconst QuoteTitle = styled.p`\n  font-size: 20px;\n  font-weight: 600;\n  text-shadow: 1px 1px 5px #ccc;\n  margin-top: 5px;\n`\n\nconst QuoteTitle2 = styled.p`\n  color: #979797;\n  font-size: 15px;\n  font-weight: 300;\n  text-shadow: 0px 0px 0px #ccc;\n`\n\nconst Text1 = styled.p`\n  color: #EBEBEB;\n  font-size: 15px;\n  font-weight: 400;\n  margin-bottom: 0px;\n  text-shadow: 0px 0px 0px #ccc;\n`\n\nconst Text11 = styled.p`\n  color: #EBEBEB;\n  font-size: 15px;\n  font-weight: 800;\n  margin-bottom: 0px;\n`\n\nconst Divider = styled.div`\n  background-color: #7B7B7B;\n  height: 1.5px;\n  margin-left: auto;\n  margin-right: auto;\n  margin-top: 15px;\n  margin-bottom: 15px;\n  width: 100%;\n`\n\nconst SmallText = styled.p`\n  color: #979797;\n  font-size: 15px;\n  font-weight: 200;\n  margin-bottom: 0px;\n  margin-left: 20px;\n`\n\nconst Wrapper = styled(Flex)`\n  svg {\n    margin-right: 0.25rem;\n  }\n`\n\nconst StyledBtn = styled.button`\n  -webkit-box-align: center;\n  align-items: center;\n  background-color: rgba(0, 0, 0,0) !important;\n  border: 1px;\n  border-style: solid !important;\n  border-color: #ffff !important;\n  border-radius: 10px;\n  color: #ffff;\n  font-size: 15px;\n  font-weight: 400;\n  width: 100%;\n  display: inline-flex;\n  min-height: 30px;\n  max-height: 30px;\n  max-width: 135px;\n  padding: 20px;\n`\n\nconst StyledCardActions = styled.div`\n  display: flex;\n  justify-content: center;\n  margin-top: 15px;\n  width: 100%;\n  margin-bottom: 15px;\n  box-sizing: border-box;\n`\n\n\nconst StyledActionSpacer = styled.div`\n  height: ${(props) => props.theme.spacing[4]}px;\n  width: ${(props) => props.theme.spacing[4]}px;\n`\n\nconst StyledBtn2 = styled.button`\n  -webkit-box-align: center;\n  align-items: center;\n  background-color: rgba(0, 0, 0,0) !important;\n  border: 1px;\n  border-style: solid !important;\n  border-color: #ffff !important;\n  border-radius: 10px;\n  color: #ffff;\n  font-size: 15px;\n  font-weight: 800;\n  width: 100%;\n  display: inline-flex;\n  min-height: 30px;\n  max-height: 30px;\n  max-width: 118px;\n  padding: 20px;\n\n  border: 2px solid #fff;\n  box-shadow: 0px 0px 7px #ffff;\n`\n\n\ninterface PoolWithApy extends Pool {\n  apy: BigNumber\n  apr: BigNumber\n}\n\ninterface HarvestProps {\n  pool: PoolWithApy\n}\n\nconst PoolCard: React.FC<HarvestProps> = ({ pool }) => {\n  const {\n    sousId,\n    stakingTokenName,\n    stakingTokenAddress,\n    apr,\n    apy,\n    tokenDecimals,\n    poolCategory,\n    isFinished,\n    userData,\n    stakingLimit,\n    pricePerShare\n  } = pool\n\n  const cakeBalance = getBalanceNumber(useTokenBalance(getCakeAddress())).toLocaleString('en-us',{ maximumFractionDigits: 0 });\n  const isBnbPool = poolCategory === PoolCategory.BINANCE\n  const TranslateString = useI18n()\n  const stakingTokenContract = useERC20(stakingTokenAddress)\n  const { account } = useWallet()\n  const { onApprove } = useSousApprove(stakingTokenContract, sousId)\n  const { onStake } = useSousStake(sousId, isBnbPool)\n  const { onUnstake } = useSousUnstake(sousId)\n  const { onReward } = useSousHarvest(sousId, isBnbPool)\n  const rvrsPrice = usePriceCakeBusd()\n  const { secondsRemaining, hasUnstakingFee } = useWithdrawFeeTimer(\n      userData ? userData.lastDepositedTime.toNumber() : 0,\n      parseInt('259200', 10)\n  );\n  const [requestedApproval, setRequestedApproval] = useState(false)\n  const [pendingTx, setPendingTx] = useState(false)\n  const allowance = new BigNumber(userData?.allowance || 0)\n  const stakingTokenBalance = new BigNumber(userData?.stakingTokenBalance || 0)\n  const stakedBalance = new BigNumber(userData?.stakedBalance || 0)\n  const earnings = new BigNumber(userData?.pendingReward || 0)\n  const stakedBalanceUsd = stakedBalance.times(rvrsPrice)\n  const isOldSyrup = stakingTokenName === QuoteToken.SYRUP\n  const accountHasStakedBalance = stakedBalance?.toNumber() > 0\n  const needsApproval = !accountHasStakedBalance && !allowance.toNumber() && !isBnbPool\n  const isCardActive = isFinished && accountHasStakedBalance\n  const convertedLimit = new BigNumber(stakingLimit).multipliedBy(new BigNumber(10).pow(tokenDecimals))\n  const [onPresentDeposit] = useModal(\n    <DepositModal\n      max={stakingLimit && stakingTokenBalance.isGreaterThan(convertedLimit) ? convertedLimit : stakingTokenBalance}\n      onConfirm={onStake}\n      tokenName={stakingLimit ? `${stakingTokenName} (${stakingLimit} max)` : stakingTokenName}\n    />,\n  )\n  const [onPresentWithdraw] = useModal(\n    <WithdrawModal max={stakedBalance} onConfirm={onUnstake} tokenName={stakingTokenName} pricePerShare={pricePerShare} />,\n  )\n  const handleApprove = useCallback(async () => {\n    try {\n      setRequestedApproval(true)\n      const txHash = await onApprove()\n      // user rejected tx or didn't go thru\n      if (!txHash) {\n        setRequestedApproval(false)\n      }\n    } catch (e) {\n      console.error(e)\n    }\n  }, [onApprove, setRequestedApproval])\n  const TVL = pool.tvl && pool.tvl.toNumber().toLocaleString('en-us',{ maximumFractionDigits: 0 });\n  const APY = apy && apy.toNumber().toLocaleString('en-us',{ maximumFractionDigits: 0 });\n  const StakedUSDBalance = getBalanceNumber(stakedBalanceUsd).toLocaleString('en-us',{ maximumFractionDigits: 0 })\n  const FiveDayROI = apr && apr.div(53).toNumber().toLocaleString('en-us',{ maximumFractionDigits: 0 });\n  const ExpectedBalance = apr && apr.div(365).times(7).times(0.01).times(getBalanceNumber(stakedBalanceUsd)).plus(getBalanceNumber(stakedBalanceUsd)).toNumber().toLocaleString('en-us',{ maximumFractionDigits: 0 });\n  const TotalAPY = apy && apy.plus(445).toNumber().toLocaleString('en-us',{ maximumFractionDigits: 0 });\n  const bal = getBalanceNumber(stakedBalance).toLocaleString('en-us',{ maximumFractionDigits: 0 });\n\n  return (\n    <Card isActive={isCardActive} isFinished={isFinished && sousId !== 0}>\n\n      <div style={{padding: '34px'}}>\n\n        <Wrapper \n          justifyContent=\"center\" \n          alignItems=\"center\"\n          padding='20px' \n          >\n\n          <Flex flexDirection=\"column\" alignItems='center'>\n            <QuoteTitle2>Total APY</QuoteTitle2>\n            <QuoteTitle>{TotalAPY}%</QuoteTitle>\n          </Flex>\n          <Flex  flexDirection=\"column\" alignItems='center' marginLeft='60px'>\n            <QuoteTitle2> TVL</QuoteTitle2>\n            <QuoteTitle >${TVL}</QuoteTitle>\n          </Flex>\n        </Wrapper>\n\n        <Flex justifyContent='space-between' marginTop='18px'>\n          <Text1>UST APY</Text1>\n          <Text1>445%</Text1>\n        </Flex>\n\n        \n        <Flex justifyContent='space-between' marginTop='10px'>\n          <Text1>RVRS APY</Text1>\n          <Text1>{APY}%</Text1>\n        </Flex>\n\n        <Flex justifyContent='space-between' marginTop='10px'>\n          <Text1> 7 Day ROI</Text1>\n          <Text1>{FiveDayROI}%</Text1>\n        </Flex>\n\n        <Divider/>\n\n        <Flex justifyContent='space-between' marginTop='14px'>\n          <Text1>Unstaked Balance</Text1>\n          <Text1>{cakeBalance}</Text1>\n        </Flex>\n\n        <Flex justifyContent='space-between' marginTop='10px'>\n          <Text1>Staked Balance</Text1>\n          <Text1>{bal}</Text1>\n        </Flex>\n\n        <Flex justifyContent='space-between' marginTop='12px'>\n          <SmallText>Balance (in UST)</SmallText>\n          <SmallText>${StakedUSDBalance}</SmallText>\n        </Flex>\n\n        <Flex justifyContent='space-between' marginTop='5px'>\n          <SmallText>Expected Balance (7 Days)</SmallText>\n          <SmallText>${ExpectedBalance}</SmallText>\n        </Flex>\n\n        \n\n\n\n\n        <Wrapper alignItems=\"end\">\n\n        <Flex alignItems=\"end\">\n\n          <StyledCardActions style={{alignItems:\"end\"}} >\n            {account && (needsApproval && !isOldSyrup ? (\n            \n            <div style={{ flex: 1 }}>\n              <StyledBtn\n\n \n                style={{minWidth:'100px', maxWidth:'150px', boxShadow:'0px 0px 5px #fff', 'marginTop':'10px'}}\n                disabled={isFinished || requestedApproval}\n                onClick={handleApprove}>\n                Enable Staking\n              </StyledBtn>\n            </div>\n\n            ) : ( <>\n\n              <StyledBtn \n                style={{marginTop:'20px'}}\n                disabled={stakedBalance.eq(new BigNumber(0)) || pendingTx}\n                onClick={ isOldSyrup ? async () => {\n                  setPendingTx(true)\n                  await onUnstake('0')\n                  setPendingTx(false)} : onPresentWithdraw }>\n                Unstake (0,0)\n              </StyledBtn>\n\n              <StyledActionSpacer/>\n                {!isOldSyrup && (\n                <StyledBtn2 \n                  style={{marginTop:'20px'}} \n                  disabled={isFinished && sousId !== 0} \n                  onClick={onPresentDeposit}>\n                  Stake (3,3)\n                </StyledBtn2>)} </> ))}\n              </StyledCardActions> \n                    \n            </Flex>\n        </Wrapper>\n      </div>\n    </Card>\n  )\n}\n\nexport default PoolCard\n"]},"metadata":{},"sourceType":"module"}