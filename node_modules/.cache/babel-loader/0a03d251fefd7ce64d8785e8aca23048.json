{"ast":null,"code":"import _regeneratorRuntime from\"/Users/ignacio/Documents/GitHub/reverse-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/ignacio/Documents/GitHub/reverse-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/ignacio/Documents/GitHub/reverse-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import BigNumber from'bignumber.js';import React,{useCallback,useState}from'react';import{useSousApproveBurn}from'hooks/useApprove';import{useSousStakeBurn}from'hooks/useStake';import{useSousHarvestBurn}from'hooks/useHarvest';import{Flex,useModal}from'@pancakeswap-libs/uikit';import{useWallet}from'@binance-chain/bsc-use-wallet';import{useERC20}from'hooks/useContract';import useBlock from'hooks/useBlock';import{getBalanceNumber}from'utils/formatBalance';import{Skeleton}from'components/Skeleton';import BondsContainer from'../../components/layout/containers/bondsContainer';import ContentCard from'../../components/layout/cards/bonds/contentCard';import HeaderCard from'../../components/layout/cards/bonds/headerCard';import DepositModal from'../../components/bondModal';import ClaimButtonDisabled from'../../components/layout/buttons/claimButtonDisabled';import BondButton from'../../components/layout/buttons/bondButton';import BondButtonDisabled from'../../components/layout/buttons/bondButtonDisabled';import ClaimButton from'../../components/layout/buttons/claimButton';import Typography from'../../components/layout/typography/typography';import TypographyBold from'../../components/layout/typography/typographyBold';import TypographyTitle from'../../components/layout/typography/typographyTitle';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Bonds=function Bonds(_ref){var pool2=_ref.pool2;var sousId=pool2.sousId,tokenName=pool2.tokenName,stakingTokenName=pool2.stakingTokenName,stakingTokenAddress=pool2.stakingTokenAddress,apy=pool2.apy,tokenDecimals=pool2.tokenDecimals,startBlock=pool2.startBlock,endBlock=pool2.endBlock,userData=pool2.userData,stakingLimit=pool2.stakingLimit;var block=useBlock();var user=useWallet();var tokenAddress=useERC20(stakingTokenAddress);var allowance=new BigNumber((userData===null||userData===void 0?void 0:userData.allowance)||0);var earnings=new BigNumber((userData===null||userData===void 0?void 0:userData.pendingReward)||0);var earningsNo=earnings.toNumber();var convertedLimit=new BigNumber(stakingLimit).multipliedBy(new BigNumber(10).pow(tokenDecimals));// functions\nvar _useSousApproveBurn=useSousApproveBurn(tokenAddress,sousId),onApprove=_useSousApproveBurn.onApprove;var _useSousStakeBurn=useSousStakeBurn(sousId),onStake=_useSousStakeBurn.onStake;var _useSousHarvestBurn=useSousHarvestBurn(sousId),onReward=_useSousHarvestBurn.onReward;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),requestedApproval=_useState2[0],setRequestedApproval=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),pendingTx=_useState4[0],setPendingTx=_useState4[1];// bond token balance\nvar bondTokenBalance=new BigNumber((userData===null||userData===void 0?void 0:userData.stakingTokenBalance)||0);var bondTokenBalanceNo=bondTokenBalance.toNumber();var bondTokenBalanceStr=bondTokenBalanceNo.toLocaleString('en-us',{maximumFractionDigits:2,minimumFractionDigits:0});// bonded balance\nvar bondedBalance=new BigNumber((userData===null||userData===void 0?void 0:userData.stakedBalance)||0);var bondedBalanceNo=bondedBalance.toNumber();var bondedBalanceStr=getBalanceNumber(bondedBalance).toLocaleString('en-us',{maximumFractionDigits:2,minimumFractionDigits:2});// misc\nvar userHasBondedBalance=(bondedBalance===null||bondedBalance===void 0?void 0:bondedBalance.toNumber())>0;var needsApproval=!userHasBondedBalance&&!allowance.toNumber();// to start \nvar hasStarted=block>startBlock;var hoursToStartNo=(startBlock-block)*2*0.000277778;var hoursToStartStr=hoursToStartNo.toLocaleString('en-us',{maximumFractionDigits:2,minimumFractionDigits:0});// vesting period\nvar hasEnded=block>endBlock;var vesting=block>startBlock?(endBlock-block)*2*0.000277778*0.0416667:(endBlock-startBlock)*2*0.000277778*0.0416667;var vestingStr=vesting.toLocaleString('en-us',{maximumFractionDigits:1});// returns\nvar roiNo=(apy&&apy.div(365).times(vesting).minus(100)).toNumber();var positiveRoi=roiNo>0;var fivePercentRoi=roiNo>5;var roiStr=roiNo.toLocaleString('en-us',{maximumFractionDigits:0,minimumFractionDigits:0});// tvl\nvar tbvNo=pool2.tvl&&pool2.tvl.toNumber();var tbvStr=tbvNo.toLocaleString('en-us',{maximumFractionDigits:0,minimumFractionDigits:0});// rewards to claim\nvar rewardsNo=getBalanceNumber(earnings,tokenDecimals);var rewardsStr=rewardsNo.toLocaleString('en-us',{maximumFractionDigits:2,minimumFractionDigits:0});// bond modal\nvar _useModal=useModal(/*#__PURE__*/_jsx(DepositModal,{max:stakingLimit&&bondTokenBalance.isGreaterThan(convertedLimit)?convertedLimit:bondTokenBalance,onConfirm:onStake,tokenName:stakingLimit?\"\".concat(stakingTokenName,\" (\").concat(stakingLimit,\" max)\"):stakingTokenName})),_useModal2=_slicedToArray(_useModal,1),onPresentDeposit=_useModal2[0];// approve tx\nvar handleApprove=useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var txHash;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;setRequestedApproval(true);_context.next=4;return onApprove();case 4:txHash=_context.sent;if(!txHash){setRequestedApproval(false);}_context.next=11;break;case 8:_context.prev=8;_context.t0=_context[\"catch\"](0);console.error(_context.t0);case 11:case\"end\":return _context.stop();}}},_callee,null,[[0,8]]);})),[onApprove,setRequestedApproval]);return/*#__PURE__*/_jsxs(BondsContainer,{children:[/*#__PURE__*/_jsx(HeaderCard,{children:hasStarted?/*#__PURE__*/_jsxs(Flex,{justifyContent:\"space-between\",children:[/*#__PURE__*/_jsx(Flex,{justifyContent:\"space-between\",children:/*#__PURE__*/_jsx(TypographyTitle,{children:/*#__PURE__*/_jsxs(Flex,{justifyContent:\"space-between\",children:[/*#__PURE__*/_jsxs(TypographyTitle,{style:{marginLeft:\"17px\"},children:[tokenName,\"\\xA0\"]}),/*#__PURE__*/_jsx(\"a\",{target:\"_blanK\",rel:\"noreferrer\",href:\"https://reverse.gitbook.io/docs/the-protocol/reverseum-bonding-pools\",className:\"nav-links\",children:/*#__PURE__*/_jsx(TypographyTitle,{style:{borderBottom:'1px dotted #FFFF'},children:\"rvBond\"})})]})})}),fivePercentRoi?/*#__PURE__*/_jsx(Flex,{alignItems:\"end\",children:user&&(needsApproval?/*#__PURE__*/_jsx(BondButton,{style:{justifyContent:\"center\"},disabled:hasEnded,onClick:handleApprove,children:\"Enable\"}):/*#__PURE__*/_jsx(BondButton,{style:{justifyContent:\"center\"},disabled:hasEnded,onClick:onPresentDeposit,children:\"Bond\"}))}):/*#__PURE__*/_jsx(Flex,{alignItems:\"end\",children:user&&/*#__PURE__*/_jsx(BondButtonDisabled,{disabled:true,children:\"Sold Out\"})})]}):/*#__PURE__*/_jsxs(Flex,{justifyContent:\"space-between\",children:[/*#__PURE__*/_jsx(TypographyTitle,{children:/*#__PURE__*/_jsxs(Flex,{justifyContent:\"space-between\",children:[/*#__PURE__*/_jsxs(TypographyTitle,{style:{marginLeft:\"17px\"},children:[tokenName,\"\\xA0\"]}),/*#__PURE__*/_jsx(\"a\",{target:\"_blanK\",rel:\"noreferrer\",href:\"https://reverse.gitbook.io/docs/the-protocol/reverseum-bonding-pools\",className:\"nav-links\",children:/*#__PURE__*/_jsx(TypographyTitle,{style:{borderBottom:'1px dotted #FFFF'},children:\"rvBond\"})})]})}),/*#__PURE__*/_jsx(Flex,{alignItems:\"end\",children:/*#__PURE__*/_jsx(\"div\",{children:hoursToStartNo>1000?/*#__PURE__*/_jsx(BondButtonDisabled,{disabled:true,style:{justifyContent:\"center\"},children:/*#__PURE__*/_jsx(Skeleton,{height:10})}):/*#__PURE__*/_jsxs(BondButtonDisabled,{disabled:true,style:{justifyContent:\"center\"},children:[hoursToStartStr,\"h Left\"]})})})]})}),/*#__PURE__*/_jsxs(Flex,{justifyContent:\"space-between\",children:[/*#__PURE__*/_jsx(ContentCard,{children:/*#__PURE__*/_jsxs(Flex,{justifyContent:\"space-between\",children:[/*#__PURE__*/_jsxs(Flex,{flexDirection:\"column\",alignItems:\"start\",children:[/*#__PURE__*/_jsx(TypographyBold,{style:{marginBottom:\"5px\"},children:\"vROI\"}),hasStarted?/*#__PURE__*/_jsx(\"div\",{children:positiveRoi?/*#__PURE__*/_jsxs(Typography,{children:[roiStr,\"%\"]}):/*#__PURE__*/_jsx(Typography,{children:\"Sold\\xA0Out\"})}):/*#__PURE__*/_jsx(Skeleton,{height:10,width:60})]}),/*#__PURE__*/_jsxs(Flex,{flexDirection:\"column\",alignItems:\"start\",children:[/*#__PURE__*/_jsx(TypographyBold,{style:{marginBottom:\"5px\"},children:\"Vesting\"}),!hasEnded?/*#__PURE__*/_jsx(\"div\",{children:hasStarted?/*#__PURE__*/_jsxs(Typography,{children:[vestingStr,\"\\xA0Days\"]}):/*#__PURE__*/_jsx(Skeleton,{height:10,width:60})}):/*#__PURE__*/_jsx(Typography,{children:\"Ended\"})]}),/*#__PURE__*/_jsxs(Flex,{flexDirection:\"column\",alignItems:\"start\",children:[/*#__PURE__*/_jsx(TypographyBold,{style:{marginBottom:\"5px\"},children:\"TVL\"}),/*#__PURE__*/_jsx(\"div\",{children:hasStarted?/*#__PURE__*/_jsxs(Typography,{children:[\"$\",tbvStr]}):/*#__PURE__*/_jsx(Skeleton,{height:10,width:60})})]}),user&&/*#__PURE__*/_jsxs(Flex,{flexDirection:\"column\",alignItems:\"start\",children:[/*#__PURE__*/_jsx(TypographyBold,{style:{marginBottom:\"5px\"},children:\"Bonded\"}),hasStarted?/*#__PURE__*/_jsx(\"div\",{children:bondedBalanceNo?/*#__PURE__*/_jsxs(Typography,{children:[bondedBalanceStr,\"\\xA0\",tokenName]}):/*#__PURE__*/_jsx(Typography,{children:\"N/A\"})}):/*#__PURE__*/_jsx(Typography,{children:/*#__PURE__*/_jsx(Skeleton,{height:10,width:64})})]})]})}),user&&/*#__PURE__*/_jsx(Flex,{children:rewardsNo>0?/*#__PURE__*/_jsx(ClaimButton,{style:{marginLeft:'20px',justifyContent:\"center\"},disabled:!rewardsNo,onClick:/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:setPendingTx(true);_context2.next=3;return onReward();case 3:setPendingTx(false);case 4:case\"end\":return _context2.stop();}}},_callee2);})),children:/*#__PURE__*/_jsxs(Flex,{flexDirection:\"column\",alignItems:\"center\",children:[/*#__PURE__*/_jsx(TypographyBold,{style:{marginBottom:\"4px\"},children:\"Claim\"}),hasStarted?/*#__PURE__*/_jsxs(Typography,{children:[rewardsStr,\"\\xA0RVRS\"]}):/*#__PURE__*/_jsx(Skeleton,{height:10,width:60})]})}):/*#__PURE__*/_jsx(ClaimButtonDisabled,{style:{marginLeft:'20px',justifyContent:\"center\"},disabled:!rewardsNo,onClick:/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:setPendingTx(true);_context3.next=3;return onReward();case 3:setPendingTx(false);case 4:case\"end\":return _context3.stop();}}},_callee3);})),children:/*#__PURE__*/_jsxs(Flex,{flexDirection:\"column\",alignItems:\"center\",children:[/*#__PURE__*/_jsx(TypographyBold,{style:{marginBottom:\"4px\"},children:\"Claim\"}),hasStarted?/*#__PURE__*/_jsxs(Typography,{children:[rewardsStr,\"\\xA0RVRS\"]}):/*#__PURE__*/_jsx(Skeleton,{height:10,width:60})]})})})]})]});};export default Bonds;","map":{"version":3,"sources":["/Users/ignacio/Documents/GitHub/reverse-frontend/src/pages/Bonds/card.tsx"],"names":["BigNumber","React","useCallback","useState","useSousApproveBurn","useSousStakeBurn","useSousHarvestBurn","Flex","useModal","useWallet","useERC20","useBlock","getBalanceNumber","Skeleton","BondsContainer","ContentCard","HeaderCard","DepositModal","ClaimButtonDisabled","BondButton","BondButtonDisabled","ClaimButton","Typography","TypographyBold","TypographyTitle","Bonds","pool2","sousId","tokenName","stakingTokenName","stakingTokenAddress","apy","tokenDecimals","startBlock","endBlock","userData","stakingLimit","block","user","tokenAddress","allowance","earnings","pendingReward","earningsNo","toNumber","convertedLimit","multipliedBy","pow","onApprove","onStake","onReward","requestedApproval","setRequestedApproval","pendingTx","setPendingTx","bondTokenBalance","stakingTokenBalance","bondTokenBalanceNo","bondTokenBalanceStr","toLocaleString","maximumFractionDigits","minimumFractionDigits","bondedBalance","stakedBalance","bondedBalanceNo","bondedBalanceStr","userHasBondedBalance","needsApproval","hasStarted","hoursToStartNo","hoursToStartStr","hasEnded","vesting","vestingStr","roiNo","div","times","minus","positiveRoi","fivePercentRoi","roiStr","tbvNo","tvl","tbvStr","rewardsNo","rewardsStr","isGreaterThan","onPresentDeposit","handleApprove","txHash","console","error","marginLeft","borderBottom","justifyContent","marginBottom"],"mappings":"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","sourcesContent":["import BigNumber from 'bignumber.js'\nimport React, { useCallback, useState } from 'react'\nimport { useSousApproveBurn } from 'hooks/useApprove'\nimport { useSousStakeBurn } from 'hooks/useStake'\nimport { useSousHarvestBurn } from 'hooks/useHarvest'\nimport { Flex, useModal } from '@pancakeswap-libs/uikit'\nimport { useWallet } from '@binance-chain/bsc-use-wallet'\nimport { useERC20 } from 'hooks/useContract'\nimport useBlock from 'hooks/useBlock'\nimport { getBalanceNumber } from 'utils/formatBalance'\nimport { Pool2 } from 'state/types'\nimport { Skeleton } from 'components/Skeleton'\nimport BondsContainer from '../../components/layout/containers/bondsContainer'\nimport ContentCard from '../../components/layout/cards/bonds/contentCard'\nimport HeaderCard from '../../components/layout/cards/bonds/headerCard'\nimport DepositModal from '../../components/bondModal'\nimport ClaimButtonDisabled from '../../components/layout/buttons/claimButtonDisabled'\nimport BondButton from '../../components/layout/buttons/bondButton'\nimport BondButtonDisabled from '../../components/layout/buttons/bondButtonDisabled'\nimport ClaimButton from '../../components/layout/buttons/claimButton'\nimport Typography from '../../components/layout/typography/typography'\nimport TypographyBold from '../../components/layout/typography/typographyBold'\nimport TypographyTitle from '../../components/layout/typography/typographyTitle'\n\ninterface PoolWithApy extends Pool2 {\n  apy: BigNumber\n}\n\ninterface HarvestProps {\n  pool2: PoolWithApy\n}\n\nconst Bonds: React.FC<HarvestProps> = ({ pool2 }) => {\n  const {\n    sousId,\n    tokenName,\n    stakingTokenName,\n    stakingTokenAddress,\n    apy,\n    tokenDecimals,\n    startBlock,\n    endBlock,\n    userData,\n    stakingLimit,\n  } = pool2\n\n  const block = useBlock();\n  const user = useWallet();\n  const tokenAddress = useERC20(stakingTokenAddress);\n  const allowance = new BigNumber(userData?.allowance || 0);\n  const earnings = new BigNumber(userData?.pendingReward || 0);\n  const earningsNo = earnings.toNumber();\n  const convertedLimit = new BigNumber(stakingLimit).multipliedBy(new BigNumber(10).pow(tokenDecimals));\n\n  // functions\n  const { onApprove } = useSousApproveBurn(tokenAddress, sousId);\n  const { onStake } = useSousStakeBurn(sousId);\n  const { onReward } = useSousHarvestBurn(sousId);\n  const [requestedApproval, setRequestedApproval] = useState(false);\n  const [pendingTx, setPendingTx] = useState(false);\n\n  // bond token balance\n  const bondTokenBalance = new BigNumber(userData?.stakingTokenBalance || 0);\n  const bondTokenBalanceNo = bondTokenBalance.toNumber();\n  const bondTokenBalanceStr = bondTokenBalanceNo.toLocaleString('en-us', { maximumFractionDigits: 2, minimumFractionDigits: 0 });\n\n  // bonded balance\n  const bondedBalance = new BigNumber(userData?.stakedBalance || 0);\n  const bondedBalanceNo = bondedBalance.toNumber();\n  const bondedBalanceStr = getBalanceNumber(bondedBalance).toLocaleString('en-us', { maximumFractionDigits: 2, minimumFractionDigits: 2 });\n\n  // misc\n  const userHasBondedBalance = bondedBalance?.toNumber() > 0\n  const needsApproval = !userHasBondedBalance && !allowance.toNumber()\n\n  // to start \n  const hasStarted = block > startBlock\n  const hoursToStartNo = (startBlock - block) * 2 * 0.000277778;\n  const hoursToStartStr = hoursToStartNo.toLocaleString('en-us', { maximumFractionDigits: 2, minimumFractionDigits: 0 });\n\n  // vesting period\n  const hasEnded = block > endBlock\n  const vesting = block > startBlock ? (endBlock - block) * 2 * 0.000277778 * 0.0416667 : (endBlock - startBlock) * 2 * 0.000277778 * 0.0416667\n  const vestingStr = vesting.toLocaleString('en-us', { maximumFractionDigits: 1 })\n\n  // returns\n  const roiNo = (apy && apy.div(365).times(vesting).minus(100)).toNumber();\n  const positiveRoi = roiNo > 0;\n  const fivePercentRoi = roiNo > 5;\n  const roiStr = roiNo.toLocaleString('en-us', { maximumFractionDigits: 0, minimumFractionDigits: 0 });\n\n  // tvl\n  const tbvNo = pool2.tvl && pool2.tvl.toNumber();\n  const tbvStr = tbvNo.toLocaleString('en-us', { maximumFractionDigits: 0, minimumFractionDigits: 0 });\n\n  // rewards to claim\n  const rewardsNo = getBalanceNumber(earnings, tokenDecimals);\n  const rewardsStr = rewardsNo.toLocaleString('en-us', { maximumFractionDigits: 2, minimumFractionDigits: 0 });\n\n  // bond modal\n  const [onPresentDeposit] = useModal(\n    <DepositModal\n      max={stakingLimit && bondTokenBalance.isGreaterThan(convertedLimit) ? convertedLimit : bondTokenBalance}\n      onConfirm={onStake}\n      tokenName={stakingLimit ? `${stakingTokenName} (${stakingLimit} max)` : stakingTokenName}\n    />\n  )\n\n  // approve tx\n  const handleApprove = useCallback(async () => {\n    try {\n      setRequestedApproval(true)\n      const txHash = await onApprove()\n      if (!txHash) { setRequestedApproval(false) }\n    }\n    catch (e) { console.error(e) }\n  }, [onApprove, setRequestedApproval])\n\n  return (\n    <BondsContainer>\n      <HeaderCard>\n        {hasStarted ?\n          <Flex justifyContent=\"space-between\">\n            <Flex justifyContent=\"space-between\">\n              <TypographyTitle>\n                <Flex justifyContent=\"space-between\">\n                  <TypographyTitle style={{ marginLeft: \"17px\" }}>{tokenName}&nbsp;</TypographyTitle>\n                  <a target=\"_blanK\" rel=\"noreferrer\" href=\"https://reverse.gitbook.io/docs/the-protocol/reverseum-bonding-pools\" className=\"nav-links\">\n                    <TypographyTitle style={{ borderBottom: '1px dotted #FFFF' }}>rvBond</TypographyTitle>\n                  </a>\n                </Flex>\n              </TypographyTitle>\n            </Flex>\n            {fivePercentRoi ?\n              <Flex alignItems=\"end\">\n                {user && (needsApproval ? (\n                  <BondButton\n                    style={{ justifyContent: \"center\" }}\n                    disabled={hasEnded}\n                    onClick={handleApprove}>\n                    Enable\n                  </BondButton>\n                ) : (\n                  <BondButton style={{ justifyContent: \"center\" }}\n                    disabled={hasEnded}\n                    onClick={onPresentDeposit}>\n                    Bond\n                  </BondButton>\n                ))}\n              </Flex>\n              :\n              <Flex alignItems=\"end\">\n                {user &&\n                  <BondButtonDisabled disabled>Sold Out</BondButtonDisabled>\n                }\n              </Flex>\n            }\n          </Flex>\n          :\n          <Flex justifyContent=\"space-between\">\n            <TypographyTitle>\n              <Flex justifyContent=\"space-between\">\n                <TypographyTitle style={{ marginLeft: \"17px\" }}>{tokenName}&nbsp;</TypographyTitle>\n                <a target=\"_blanK\" rel=\"noreferrer\" href=\"https://reverse.gitbook.io/docs/the-protocol/reverseum-bonding-pools\" className=\"nav-links\">\n                  <TypographyTitle style={{ borderBottom: '1px dotted #FFFF' }}>rvBond</TypographyTitle>\n                </a>\n              </Flex>\n            </TypographyTitle>\n            <Flex alignItems=\"end\">\n              <div>\n                {hoursToStartNo > 1000 ?\n                  <BondButtonDisabled disabled style={{ justifyContent: \"center\" }}>\n                    <Skeleton height={10} />\n                  </BondButtonDisabled>\n                  :\n                  <BondButtonDisabled disabled style={{ justifyContent: \"center\" }}>\n                    {hoursToStartStr}h Left\n                  </BondButtonDisabled>\n                }\n              </div>\n            </Flex>\n          </Flex>\n        }\n      </HeaderCard>\n      <Flex justifyContent=\"space-between\">\n        <ContentCard>\n          <Flex justifyContent=\"space-between\">\n            {/* ROI */}\n            <Flex flexDirection=\"column\" alignItems=\"start\">\n              <TypographyBold style={{ marginBottom: \"5px\" }}>vROI</TypographyBold>\n              {hasStarted ?\n                <div>\n                  {positiveRoi ?\n                    <Typography>{roiStr}%</Typography>\n                    :\n                    <Typography>Sold&nbsp;Out</Typography>\n                  }\n                </div>\n                :\n                <Skeleton height={10} width={60} />\n              }\n            </Flex>\n            {/* Vesting */}\n            <Flex flexDirection=\"column\" alignItems=\"start\">\n              <TypographyBold style={{ marginBottom: \"5px\" }}>Vesting</TypographyBold>\n              {!hasEnded ?\n                <div>\n                  {hasStarted ?\n                    <Typography>{vestingStr}&nbsp;Days</Typography>\n                    :\n                    <Skeleton height={10} width={60} />}\n                </div>\n                :\n                <Typography>Ended</Typography>\n              }\n            </Flex>\n            {/* TVL */}\n            <Flex flexDirection=\"column\" alignItems=\"start\">\n              <TypographyBold style={{ marginBottom: \"5px\" }}>TVL</TypographyBold>\n              <div>\n                {hasStarted ?\n                  <Typography>${tbvStr}</Typography>\n                  :\n                  <Skeleton height={10} width={60} />}\n              </div>\n            </Flex>\n            {/* Bonded by user */}\n            {user && (\n              <Flex flexDirection=\"column\" alignItems=\"start\">\n                <TypographyBold style={{ marginBottom: \"5px\" }}>Bonded</TypographyBold>\n                {hasStarted ?\n                  <div>\n                    {bondedBalanceNo ?\n                      <Typography>{bondedBalanceStr}&nbsp;{tokenName}</Typography>\n                      :\n                      <Typography>N/A</Typography>\n                    }\n                  </div>\n                  :\n                  <Typography><Skeleton height={10} width={64} /></Typography>\n                }\n              </Flex>\n            )}\n          </Flex>\n        </ContentCard>\n        {/* Claim RVRS */}\n        {user && (\n          <Flex>\n            {rewardsNo > 0 ?\n              <ClaimButton\n                style={{ marginLeft: '20px', justifyContent: \"center\" }}\n                disabled={!rewardsNo}\n                onClick={async () => {\n                  setPendingTx(true)\n                  await onReward()\n                  setPendingTx(false)\n                }}>\n                <Flex flexDirection=\"column\" alignItems=\"center\">\n                  <TypographyBold style={{ marginBottom: \"4px\" }}>Claim</TypographyBold>\n                  {hasStarted ?\n                    <Typography>{rewardsStr}&nbsp;RVRS</Typography>\n                    :\n                    <Skeleton height={10} width={60} />\n                  }\n                </Flex>\n              </ClaimButton>\n              :\n              <ClaimButtonDisabled\n                style={{ marginLeft: '20px', justifyContent: \"center\" }}\n                disabled={!rewardsNo}\n                onClick={async () => {\n                  setPendingTx(true)\n                  await onReward()\n                  setPendingTx(false)\n                }}>\n                <Flex flexDirection=\"column\" alignItems=\"center\">\n                  <TypographyBold style={{ marginBottom: \"4px\" }}>Claim</TypographyBold>\n                  {hasStarted ?\n                    <Typography>{rewardsStr}&nbsp;RVRS</Typography>\n                    :\n                    <Skeleton height={10} width={60} />\n                  }\n                </Flex>\n              </ClaimButtonDisabled>\n            }\n          </Flex>\n        )}\n      </Flex>\n    </BondsContainer>\n  )\n}\n\nexport default Bonds\n\n\n"]},"metadata":{},"sourceType":"module"}